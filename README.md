# SDC-Net Dockeré•œåƒç‰ˆæœ¬è¯´æ˜
æœ¬æ¨¡å—è®°å½• SDC-Net Docker é•œåƒçš„ç»´æŠ¤å†å²ä¸ç‰ˆæœ¬è¿­ä»£è¯¦æƒ…ã€‚
`SDC-Net:20260130-V05-SXP` ç‰ˆç”±å­™æ™“é¹äº2026/01/30å°è£…ã€‚ä¸”åœ¨å°è£…åï¼Œè¿›è¡Œäº†è·¨è®¾å¤‡æµ‹è¯•å®éªŒã€‚

### 2026.01.30: SDC-Net V05 (å½“å‰ç‰ˆæœ¬)
* **ç»´æŠ¤äºº**: å­™æ™“é¹
* **é•œåƒæ ‡ç­¾**: `sdc-net:20260130-V05-SXP`

**æ›´æ–°ç‰¹æ€§ (Features):**
* **è·¨è®¾å¤‡è¿ç§»**ï¼šè¿›è¡Œäº†è·¨è®¾å¤‡æµ‹è¯•å®éªŒ

### 2026.01.29: SDC-Net V04
* **ç»´æŠ¤äºº**: å­™æ™“é¹
* **é•œåƒæ ‡ç­¾**: `sdc-net:20260129-V05-SXP`

**æ›´æ–°ç‰¹æ€§ (Features):**
* **ç¯å¢ƒæ„å»º**: å®Œæˆ PyTorch + MMSegmentation åŸºç¡€ç¯å¢ƒçš„å°è£…ä¸æµ‹è¯•ã€‚
* **å…¨æµç¨‹è·‘é€š**: éªŒè¯äº†å•å¡/å¤šå¡è®­ç»ƒ (`dist_train`)ã€æµ‹è¯• (`test`) åŠæ¨ç† (`inference`) è„šæœ¬çš„å¯ç”¨æ€§ã€‚


---

# SDC-Net Dockeré•œåƒç»“æ„è¯´æ˜
SDC-Net Dockeré•œåƒï¼Œå¯æä¾›ç”¨äºè®­ç»ƒä¸æµ‹è¯•SDC-Netæ¨¡å‹çš„å®Œæ•´ç¯å¢ƒã€‚

- é¡¹ç›®ä¸»è¦è·¯å¾„ç»„ç»‡å¦‚ä¸‹ï¼š
```
app/
â”œâ”€â”€ ğŸ“‚ configs/
â”‚   â”œâ”€â”€ ğŸ“‚ _base_/
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ models/
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ isdnet_r50-d8.py        # æ¨¡å‹åŸºåº§ï¼šç»§æ‰¿è‡ª ISDNet
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ datasets/
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ IDRiD_512x512.py        # æ•°æ®é›†é…ç½®
â”‚   â”‚   â””â”€â”€ ğŸ“‚ schedules/
â”‚   â”‚       â””â”€â”€ ğŸ“„ schedule_40k.py         # è®­ç»ƒæ—¶é•¿é…ç½® (40k iterations)
â”‚   â”œâ”€â”€ ğŸ“‚ sdcnet/
â”‚   â”‚   â””â”€â”€ ğŸ“„ sdcnetplus_r18...IDRiD.py   # â­ SDC-Net æ ¸å¿ƒé…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ ğŸ“„ default_runtime.py              # è¿è¡Œæ—¥å¿—é…ç½®
â”œâ”€â”€ ğŸ“‚ mmseg/
â”‚   â”œâ”€â”€ ğŸ“‚ models/                         # æ¨¡å‹æ ¸å¿ƒä»£ç å­˜æ”¾
â”‚   â”‚   â””â”€â”€ ğŸ“‚ decode_heads/               # é¡¹ç›®æ¨¡å—å®šä¹‰ (ASPPã€DSWMç­‰)
â”‚   â”œâ”€â”€ ğŸ“‚ apis/                           # mmsegåŸºç¡€åŠŸèƒ½ (éƒ¨åˆ†ç»§æ‰¿è‡ªtrain.py)
â”‚   â””â”€â”€ ğŸ“‚ backbones/                      # ResNet18 çš„æ ‡å‡†å®ç°
â”œâ”€â”€ ğŸ“‚ requirements/                       # ä¾èµ–å®‰è£…ç›®å½•
â””â”€â”€ ğŸ“‚ tools/
    â”œâ”€â”€ ğŸ“„ train.py                        # è®­ç»ƒè„šæœ¬
    â”œâ”€â”€ ğŸ“„ test.py                         # æµ‹è¯•è„šæœ¬
    â””â”€â”€ ğŸ“„ inference.py                    # æ¨ç†è„šæœ¬
```

# SDC-Net Dockeré•œåƒä½¿ç”¨è¯´æ˜
ä¸‹é¢æ•™ç¨‹å°†åŸºäºå·²è·å¾—çš„SDC-Net dockeré•œåƒï¼Œè¯´æ˜å¦‚ä½•è§„èŒƒåŒ–åœ°ä½¿ç”¨SDC-Netæ¨¡å‹åŠç›¸å…³ç¯å¢ƒï¼ŒåŒ…æ‹¬é•œåƒåŠ è½½ï¼Œcontainerå¯åŠ¨ï¼ŒåŸºäºå‘½ä»¤è¡Œã€VS Codeçš„è¿æ¥è®¿é—®ï¼Œä»¥åŠå¸¸è§é—®é¢˜çš„è§£å†³ã€‚

## ğŸ“‹ å‰ç½®è¦æ±‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·åšå¥½å¦‚ä¸‹å‡†å¤‡å·¥ä½œï¼š
* è·å¾—SDC-Net dockeré•œåƒï¼Œå¹¶ä¼ å…¥æœåŠ¡å™¨ã€‚
* æœåŠ¡å™¨ä¸­å·²å®‰è£… **Docker Engine**ã€‚
* å¦‚éœ€é€šè¿‡SSH CLIä½¿ç”¨Dockerä¸­çš„æ¨¡å‹ï¼Œæå‰å®‰è£…MobaXtermç­‰ç»ˆç«¯è½¯ä»¶ã€‚
* å¦‚éœ€é€šè¿‡VS Codeä½¿ç”¨Dockerä¸­çš„æ¨¡å‹ï¼Œæœ¬åœ°æˆ–è¿œç¨‹ VS Code å·²å®‰è£… **Dev Containers** (ms-vscode-remote.remote-containers) æ‰©å±•æ’ä»¶ã€‚
* å¦‚éœ€æµ‹è¯•æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ï¼Œè¯·æå‰å‡†å¤‡å¥½IDRIDã€FGADRã€DDRæ•°æ®é›†ï¼Œå¹¶æ”¾ç½®åœ¨æœåŠ¡å™¨çš„ç‰¹å®šä½ç½®ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ (Quick Start)

### 1. åŠ è½½é•œåƒ
å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ç¦»çº¿é•œåƒåŒ… (ä»¥`sdcnet.tar`ä¸ºä¾‹)ï¼Œè¯·å…ˆæ‰§è¡ŒåŠ è½½ï¼š

```bash
# åŠ è½½é•œåƒåŒ…
docker load -i sdcnet.tar
# æŸ¥çœ‹å½“å‰æ‰€æœ‰é•œåƒï¼ŒéªŒè¯é•œåƒæ˜¯å¦åŠ è½½æˆåŠŸ
docker images
```

### 2. å¯åŠ¨å®¹å™¨å‘½ä»¤è¯´æ˜ (æ ‡å‡†æŒ‡ä»¤)

**é€šç”¨çš„**ã€**å®Œæ•´çš„**å¯åŠ¨å®¹å™¨çš„å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºã€‚

```bash
docker run -itd \      
    --gpus all \      
    --shm-size 8g \
    -v /home_nfs/dataset \
    -v $(pwd)/work_dirs:/app/work_dirs \
    sdc-net:latest /bin/bash
```

è¯¥æŒ‡ä»¤å·²åŒ…å«æ˜¾å¡è°ƒç”¨ã€å†…å­˜ä¼˜åŒ–å’Œæ•°æ®æŒ‚è½½é…ç½®ã€‚ç”±äºé‡‡ç”¨äº†æ•°æ®å·ï¼Œå¯ä»¥ç¡®ä¿è®­ç»ƒç¨³å®šæ€§å’Œæ•°æ®å®‰å…¨ã€‚

**å…³é”®å‚æ•°è¯´æ˜ï¼š**

* `-itd`: **åå°é™é»˜è¿è¡Œ**ã€‚å³ä½¿å…³é—­ VS Code æˆ–æ–­å¼€ SSHï¼Œå®¹å™¨å†…çš„è®­ç»ƒä»»åŠ¡ä¹Ÿä¸ä¼šä¸­æ–­ã€‚æ­£å¸¸å¯åŠ¨è¯·æ”¹ä¸º`-it`ã€‚
* `--gpus all`: å…è®¸å®¹å™¨è°ƒç”¨æœåŠ¡å™¨æ‰€æœ‰æ˜¾å¡ã€‚
* `--shm-size 8g`: **é‡è¦**ã€‚å°†å…±äº«å†…å­˜æ‰©å¤§è‡³ 8GBï¼Œé˜²æ­¢ PyTorch DataLoader æŠ¥é”™ `Bus error`ã€‚
* `-v (Volume)`: **æ•°æ®æŒ‚è½½**ã€‚æ ¼å¼ä¸º `å®¿ä¸»æœºè·¯å¾„:å®¹å™¨å†…è·¯å¾„`ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œdockerå°è£…ç¦æ­¢å†…éƒ¨å°è£…é¢„æƒé‡ã€æ•°æ®é›†ç­‰å†…å®¹ï¼Œå› æ­¤é¢„æƒé‡å’Œæ•°æ®é›†ä¸€èˆ¬æ˜¯åœ¨dockerå¤–éƒ¨çš„å®¿ä¸»æœºä¸Šé€šè¿‡æŒ‚è½½ä¾›dockerä½¿ç”¨ã€‚
* **å»ºè®®**ï¼šå°†å®¿ä¸»æœºçš„ `work_dirs` æŒ‚è½½åˆ°å®¹å™¨å†…ï¼Œç¡®ä¿è®­ç»ƒæƒé‡ (`.pth`) å’Œæ—¥å¿—æ–‡ä»¶æŒä¹…åŒ–ä¿å­˜ï¼Œé˜²æ­¢åˆ é™¤å®¹å™¨åæ•°æ®ä¸¢å¤±ã€‚


### 3. è·¯å¾„æ˜ å°„è§„åˆ’åŠå®¹å™¨å¯åŠ¨å‘½ä»¤

- SDC-Net dockerå†…è·¯å¾„å’Œå®¿ä¸»æœºè·¯å¾„å¯¹åº”å…³ç³»å¯è§„åˆ’ä¸ºä¸‹è¡¨æ‰€ç¤ºã€‚

| åºå· | Dockerå†…éƒ¨è·¯å¾„ | Hostå¤–éƒ¨è·¯å¾„ | è¯´æ˜ |
|:---:|:---|:---|:---|
| 1 | `/SDC-Net_use/model/` | `*HOST_WORK*/SDC-Net/model/` | é¢„è®­ç»ƒæ¨¡å‹å­˜æ”¾è·¯å¾„ |
| 2 | `/SDC-Net_use/work_dirs/` | `*HOST_WORK*/SDC-Net/work_dirs/` | è®­ç»ƒå¥½çš„æ¨¡å‹å­˜æ”¾è·¯å¾„ |
| 3 | `/SDC-Net_use/input_img/` |`*HOST_WORK*/SDC-Net/input_img/` | æ¨ç†å›¾ç‰‡è¾“å…¥è·¯å¾„ |
| 4 | `/SDC-Net_use/output_img/` | `*HOST_WORK*/SDC-Net/output_img/` | æ¨ç†å›¾ç‰‡è¾“å‡ºè·¯å¾„ |
| 5 | `/home_nfs/jiaoli.liu/ISDNet/data/IDRID/` | `*HOST_DATA*/IDRID/` | IDRIDæ•°æ®é›†å­˜æ”¾è·¯å¾„ |
| 6 | `/home_nfs/jiaoli.liu/ISDNet/data/FGADR/` | `*HOST_DATA*/FGADR/` | FGADRæ•°æ®é›†å­˜æ”¾è·¯å¾„ |
| 7 | `/home_nfs/jiaoli.liu/ISDNet/data/DDR/` | `*HOST_DATA*/DDR/` | DDRæ•°æ®é›†å­˜æ”¾è·¯å¾„ |

*æ³¨ï¼š*  
`*HOST_WORK*` è¡¨ç¤º `/home_nfs/xiaopeng.sun/project/medical_seg`  
`*HOST_DATA*` è¡¨ç¤º `/home_nfs/group.img.op/dataset/data-jiaoli`  
`/SDC-Net_use/model/` ä¸­å¯æ”¾ç½® `resnet18_8xb32_in1k_20210831-fbbb1da6.pth`ã€`latest.pth`ç­‰é¢„è®­ç»ƒæ¨¡å‹

- åŸºäºä»¥ä¸Šç›®å½•æ˜ å°„å…³ç³»ï¼Œåœ¨å®¿ä¸»æœºä¸­ï¼Œé¢„å…ˆç»„ç»‡å¥½`model`ã€`work_dirs`ã€`input_img`ã€`output_img`ï¼Œä»¥åŠæ•°æ®é›†è·¯å¾„ã€‚

- è¿è¡Œä»¥ä¸‹æ ·ä¾‹å‘½ä»¤ï¼Œå³å¯å¯åŠ¨containerã€‚

```bash
docker run -it \      
    --gpus all \      
    --shm-size 8g \
    -v /home_nfs/group.img.op/dataset/data-jiaoli:/home_nfs/jiaoli.liu/ISDNet/data
    -v /home_nfs/xiaopeng.sun/project/medical_seg/SDC-Net:/SDC-Net_use \
    sdc-net:v3.0 /bin/bash
```

---
## ğŸ’» åŸºäºå‘½ä»¤è¡Œçš„Dockerè®¿é—®

1. è¿›å…¥å®¹å™¨ç¯å¢ƒ
* runå‘½ä»¤æ­£å¸¸å¯åŠ¨å®¹å™¨

2. è®­ç»ƒæ¨¡å‹ (Train)
æ”¯æŒå•å¡è®­ç»ƒä¸å¤šå¡åˆ†å¸ƒå¼è®­ç»ƒã€‚

- å•å¡è®­ç»ƒï¼š

```bash
# è¯­æ³•ï¼špython tools/train.py <é…ç½®æ–‡ä»¶è·¯å¾„>
python tools/train.py configs/sdcnet/sdcnetplus_r18-d8_512x512_40k_IDRiD.py
```

- å¤šå¡åˆ†å¸ƒå¼è®­ç»ƒ (æ¨è)ï¼š ä¾‹å¦‚ä½¿ç”¨ 2 å¼ æ˜¾å¡ (GPU 0,1) è¿›è¡ŒåŠ é€Ÿè®­ç»ƒï¼š

```bash
# è¯­æ³•ï¼šbash tools/dist_train.sh <é…ç½®æ–‡ä»¶> <GPUæ•°é‡>
CUDA_VISIBLE_DEVICES=0,1 bash tools/dist_train.sh configs/sdcnet/sdcnetplus_r18-d8_512x512_40k_IDRiD.py 2
```
3. æµ‹è¯•æ¨¡å‹ (Test)
åŠ è½½è®­ç»ƒå¥½çš„æƒé‡æ–‡ä»¶ï¼ˆ.pthï¼‰ï¼Œè¯„ä¼°æ¨¡å‹ç²¾åº¦ï¼ˆå¦‚ mIoUï¼‰ã€‚

```bash
# è¯­æ³•ï¼špython tools/test.py <é…ç½®æ–‡ä»¶> <æƒé‡æ–‡ä»¶> --eval <æŒ‡æ ‡>
python tools/test.py configs/sdcnet/sdcnetplus_r18-d8_512x512_40k_IDRiD.py \
    /SDC-Net_use/work_dirs/latest.pth \
    --eval mIoU
```
4. æ¨¡å‹æ¨ç† (Inference)
è¯»å–è¾“å…¥è·¯å¾„çš„å›¾ç‰‡ï¼Œç”Ÿæˆæ©ç å›¾å¹¶ä¿å­˜åˆ°è¾“å‡ºè·¯å¾„ã€‚

```bash
# ç¤ºä¾‹å‘½ä»¤ (è¯·æ ¹æ® tools/inference.py çš„å®é™…å‚æ•°è°ƒæ•´)
python tools/inference.py \
    --config configs/sdcnet/sdcnetplus_r18-d8_512x512_40k_IDRiD.py \
    --checkpoint /SDC-Net_use/model/latest.pth \
    --img-dir /SDC-Net_use/input_img \
    --out-dir /SDC-Net_use/output_img
```

---

## ğŸ’» å¼€å‘ç¯å¢ƒé…ç½® (VS Code)

æ¨èä½¿ç”¨ VS Code çš„ **Dev Containers** æ’ä»¶ç›´è¿å®¹å™¨è¿›è¡Œå¼€å‘ï¼Œä½“éªŒä¸æœ¬åœ°ä¸€è‡´ã€‚

1. **å®‰è£…æ’ä»¶**ï¼šåœ¨ VS Code æ‰©å±•å•†åº—æœç´¢å¹¶å®‰è£… `Dev Containers`ã€‚
2. **è¿æ¥å®¹å™¨**ï¼š
* æŒ‰ `F1` æˆ– `Ctrl+Shift+P` æ‰“å¼€å‘½ä»¤é¢æ¿ã€‚
* è¾“å…¥å¹¶é€‰æ‹©ï¼š`Dev Containers: Attach to Running Container`ã€‚
* åœ¨åˆ—è¡¨ä¸­é€‰æ‹©åˆšæ‰å¯åŠ¨çš„å®¹å™¨ `sdc-net v3.0`ã€‚


3. **æ‰“å¼€é¡¹ç›®**ï¼š
* è¿æ¥æˆåŠŸåï¼Œç‚¹å‡»å·¦ä¾§èµ„æºç®¡ç†å™¨ -> **æ‰“å¼€æ–‡ä»¶å¤¹ (Open Folder)**ã€‚
* è¾“å…¥é¡¹ç›®è·¯å¾„ï¼ˆé»˜è®¤ä¸º `/app`ï¼‰ï¼Œç‚¹å‡»ç¡®å®šã€‚



ç°åœ¨ï¼Œä½ å¯ä»¥åœ¨ VS Code ä¸­ç›´æ¥ç¼–è¾‘ä»£ç ã€ä½¿ç”¨ç»ˆç«¯å’Œè°ƒè¯• Python è„šæœ¬ã€‚

---

